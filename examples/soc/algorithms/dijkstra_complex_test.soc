// Dijkstra Complex Validation Test
// This example tests edge cases and validates correctness

// Test 1: Classic example from textbooks
// Graph with multiple paths where greedy choice matters
//     1
//  A ---> B
//  |      |
//  5      2
//  |      |
//  v      v
//  C ---> D
//     1
// Paths A->D: A->B->D (3), A->C->D (6)
// Expected: A->B->D with distance 3

let classic = network([
    A -> B: {weight: 1},
    A -> C: {weight: 5},
    B -> D: {weight: 2},
    C -> D: {weight: 1}
])

let result1 = dijkstra(classic, "A", "D")
result1.path
result1.distance

// Test 2: Complex graph with many alternatives
// Testing that Dijkstra doesn't get stuck in local optima
let complex = network([
    S -> A: {weight: 7},
    S -> B: {weight: 2},
    S -> C: {weight: 3},
    A -> D: {weight: 4},
    B -> A: {weight: 3},
    B -> D: {weight: 8},
    C -> B: {weight: 1},
    C -> E: {weight: 7},
    D -> E: {weight: 2},
    E -> T: {weight: 1}
])

// Optimal path: S->C->B->A->D->E->T
// Cost: 3 + 1 + 3 + 4 + 2 + 1 = 14
let result2 = dijkstra(complex, "S", "T")
result2.path
result2.distance

// Test 3: Dense graph with bidirectional edges
let dense = network([
    A <> B: {weight: 4},
    A <> C: {weight: 2},
    B <> C: {weight: 1},
    B <> D: {weight: 5},
    C <> D: {weight: 8},
    C <> E: {weight: 10},
    D <> E: {weight: 2},
    D <> F: {weight: 6},
    E <> F: {weight: 3}
])

// Find shortest A to F
// Expected: A->C->B->D->E->F or A->B->C->... depending on weights
let result3 = dijkstra(dense, "A", "F")
result3.path
result3.distance

// Test 4: Triangle inequality test
// Ensures direct path isn't always chosen
let triangle = network([
    X -> Y: {weight: 10},
    X -> Z: {weight: 3},
    Z -> Y: {weight: 4}
])

// Should choose X->Z->Y (7) over X->Y (10)
let result4 = dijkstra(triangle, "X", "Y")
result4.path
result4.distance

// Test 5: Long chain with shortcut
let chain = network([
    Start -> N1: {weight: 1},
    N1 -> N2: {weight: 1},
    N2 -> N3: {weight: 1},
    N3 -> N4: {weight: 1},
    N4 -> N5: {weight: 1},
    N5 -> End: {weight: 1},
    Start -> Shortcut: {weight: 2},
    Shortcut -> End: {weight: 2}
])

// Direct chain: 6, Shortcut: 4
// Should choose shortcut
let result5 = dijkstra(chain, "Start", "End")
result5.path
result5.distance

// Test 6: Multiple equal-cost paths
// Dijkstra should find one of them
let equal_paths = network([
    S -> A: {weight: 1},
    S -> B: {weight: 1},
    A -> T: {weight: 2},
    B -> T: {weight: 2}
])

// Both S->A->T and S->B->T cost 3
let result6 = dijkstra(equal_paths, "S", "T")
result6.distance

// Test 7: Hub and spoke pattern
let hub = network([
    Src -> Hub: {weight: 5},
    Hub -> Dest: {weight: 5},
    Src -> Alt1: {weight: 3},
    Alt1 -> Alt2: {weight: 3},
    Alt2 -> Dest: {weight: 3}
])

// Direct through hub: 10
// Through alternates: 9
let result7 = dijkstra(hub, "Src", "Dest")
result7.path
result7.distance

// Test 8: Stress test with fractional weights
let fractional = network([
    A -> B: {weight: 0.5},
    B -> C: {weight: 0.7},
    C -> D: {weight: 0.3},
    A -> D: {weight: 2.0}
])

// Path through B and C: 0.5 + 0.7 + 0.3 = 1.5
// Direct: 2.0
let result8 = dijkstra(fractional, "A", "D")
result8.distance

// Test 9: Grid-like structure (simulating map routing)
let grid = network([
    A1 -> A2: {weight: 1},
    A2 -> A3: {weight: 1},
    A1 -> B1: {weight: 1},
    B1 -> B2: {weight: 1},
    B2 -> B3: {weight: 1},
    A2 -> B2: {weight: 1},
    A3 -> B3: {weight: 1},
    B1 -> C1: {weight: 1},
    C1 -> C2: {weight: 1},
    C2 -> C3: {weight: 1},
    B2 -> C2: {weight: 1},
    B3 -> C3: {weight: 1}
])

// Manhattan distance from A1 to C3
let result9 = dijkstra(grid, "A1", "C3")
result9.distance

// Test 10: Weighted complete graph K4
let k4 = network([
    V1 <> V2: {weight: 1},
    V1 <> V3: {weight: 4},
    V1 <> V4: {weight: 5},
    V2 <> V3: {weight: 2},
    V2 <> V4: {weight: 6},
    V3 <> V4: {weight: 3}
])

// From V1 to V4
// Direct: 5
// V1->V2->V3->V4: 1+2+3 = 6
// Should choose direct
let result10 = dijkstra(k4, "V1", "V4")
result10.path
result10.distance
