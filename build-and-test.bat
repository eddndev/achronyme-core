@echo off
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ  ๐ Achronyme Core - Build Complete + Performance Test       โ
echo โ  Sistema de Handles para optimizaciรณn JS โ WASM             โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

REM Check Emscripten
where emcc >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo โ Emscripten no encontrado
    echo.
    echo Activa Emscripten primero:
    echo   cd C:\ruta\a\emsdk
    echo   emsdk_env.bat
    exit /b 1
)

echo โ Emscripten encontrado
emcc --version | findstr /C:"emcc"
echo.

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  PASO 1/3: Compilar C++ โ WASM
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
call scripts\build-wasm.bat
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo โ Fallรณ la compilaciรณn de WASM
    exit /b 1
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  PASO 2/3: Compilar TypeScript โ JavaScript
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
call npm run build:js
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo โ Fallรณ la compilaciรณn de TypeScript
    exit /b 1
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  PASO 3/3: Ejecutar Performance Tests
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
node test-performance-heavy.mjs
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo โ๏ธ Tests completados con errores
    exit /b 1
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ  โ BUILD Y TESTS COMPLETADOS EXITOSAMENTE                    โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ Archivos generados:
echo    โข dist/achronyme-core.mjs
echo    โข dist/achronyme-core.wasm
echo    โข dist/sdk/*.js
echo.
echo ๐ฏ Sistema listo para usar!
