<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Direct WASM Test</title>
</head>
<body>
    <h1>Direct WASM Access Test</h1>
    <button onclick="testDirect()">Test Direct WASM</button>
    <pre id="output"></pre>

    <script type="module">
        // Import DIRECTLY from dist (bypass Vite)
        import init, * as wasm from '../dist/achronyme_wasm.js';

        window.testDirect = async function() {
            const output = document.getElementById('output');
            output.textContent = 'Testing...\n';

            try {
                // Initialize WASM
                await init();
                output.textContent += '✅ WASM initialized\n';

                // Test 1: Create vector
                const h1 = wasm.createVector([1, 2, 3]);
                output.textContent += `✅ Vector created: handle=${h1}\n`;

                // Test 2: Get vector data
                const data1 = wasm.getVector(h1);
                output.textContent += `✅ Data retrieved: [${data1.join(', ')}]\n`;

                // Test 3: Apply sin() - THIS IS THE CRITICAL TEST
                const h2 = wasm.sin(h1);
                output.textContent += `✅ sin() succeeded: handle=${h2}\n`;

                // Test 4: Get sin data
                const data2 = wasm.getVector(h2);
                output.textContent += `✅ sin data: [${data2.map(x => x.toFixed(4)).join(', ')}]\n`;

                output.textContent += '\n✅ ALL TESTS PASSED!\n';
                output.textContent += '\nThis means the fix IS working in the WASM file!\n';

            } catch (error) {
                output.textContent += `\n❌ ERROR: ${error}\n`;
                output.textContent += `Stack: ${error.stack}\n`;
                console.error(error);
            }
        };
    </script>
</body>
</html>
