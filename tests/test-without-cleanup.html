<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test WITHOUT Auto-Cleanup</title>
</head>
<body>
    <h1>Test WITHOUT Auto-Cleanup</h1>
    <button onclick="runTest()">Run Test</button>
    <pre id="output"></pre>

    <script type="module">
        import { Achronyme } from '../src/sdk/index.ts';

        window.runTest = async function() {
            const output = document.getElementById('output');
            output.textContent = 'Running...\n';

            try {
                // Initialize
                const ach = new Achronyme();
                await ach.init();
                output.textContent += '✅ SDK initialized\n';

                // Create vector WITHOUT session.use()
                const v = ach.vector([0, Math.PI/4, Math.PI/2, Math.PI]);
                output.textContent += `✅ Vector created, length: ${v.length}\n`;

                // Do math WITHOUT session.use()
                const sinV = ach.sin(v);
                output.textContent += `✅ sin() worked, result length: ${sinV.length}\n`;
                output.textContent += `   sin values: ${Array.from(sinV.data).map(x => x.toFixed(4)).join(', ')}\n`;

                const cosV = ach.cos(v);
                output.textContent += `✅ cos() worked, result length: ${cosV.length}\n`;

                // Create another vector
                const v2 = ach.linspace(0, 1, 10);
                output.textContent += `✅ linspace() worked, length: ${v2.length}\n`;

                output.textContent += '\n✅ ALL OPERATIONS SUCCESSFUL!\n';
                output.textContent += '\nNOTE: No cleanup was performed - handles are leaked.\n';
                output.textContent += 'This proves the operations work, but cleanup causes the panic.\n';

            } catch (error) {
                output.textContent += `\n❌ ERROR: ${error.message}\n`;
                output.textContent += `Stack: ${error.stack}\n`;
                console.error('Full error:', error);
            }
        };
    </script>
</body>
</html>
