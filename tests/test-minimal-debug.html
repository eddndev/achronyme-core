<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Minimal Debug Test</title>
</head>
<body>
    <h1>Minimal Debug Test</h1>
    <button onclick="test()">Run Minimal Test</button>
    <pre id="output"></pre>

    <script type="module">
        import init, * as wasm from '../dist/achronyme_wasm.js';

        window.test = async function() {
            const output = document.getElementById('output');
            output.textContent = '';

            try {
                // Debug: List all exported functions
                output.textContent += 'üìã Available functions:\n';
                const funcs = Object.keys(wasm).filter(k => typeof wasm[k] === 'function');
                output.textContent += funcs.join(', ') + '\n\n';

                await init();
                output.textContent += '‚úÖ Step 1: WASM initialized\n';

                // Test createVector (single borrow_mut)
                const h1 = wasm.createVector([1, 2, 3]);
                output.textContent += `‚úÖ Step 2: createVector succeeded, handle=${h1}\n`;

                // Test getVector (single borrow)
                const data1 = wasm.getVector(h1);
                output.textContent += `‚úÖ Step 3: getVector succeeded: [${data1}]\n`;

                // CRITICAL TEST 1: mathSin()
                output.textContent += '\nüîç TEST 1: Calling mathSin()...\n';
                try {
                    // Call the corrected, renamed function
                    const h2 = wasm.mathSin(h1); 
                    output.textContent += `‚úÖ mathSin() SUCCEEDED! handle=${h2}\n`;
                    const data2 = wasm.getVector(h2);
                    output.textContent += `   Result: [${data2.map(x => x.toFixed(4))}]\n`;
                } catch (error) {
                    output.textContent += `‚ùå mathSin() FAILED: ${error.message}\n`;
                }

                // CRITICAL TEST 2: linspace()
                output.textContent += '\nüîç TEST 2: Calling linspace()...\n';
                try {
                    const h4 = wasm.linspace(0, 10, 5);
                    output.textContent += `‚úÖ linspace() SUCCEEDED! handle=${h4}\n`;
                    const data4 = wasm.getVector(h4);
                    output.textContent += `   Result: [${data4.map(x => x.toFixed(2))}]\n`;
                } catch (error) {
                    output.textContent += `‚ùå linspace() FAILED: ${error.message}\n`;
                }

                output.textContent += '\nüéâ TEST COMPLETE!\n';

            } catch (error) {
                output.textContent += `\n‚ùå FAILED at current step\n`;
                output.textContent += `Error: ${error.message}\n`;
                output.textContent += `\nFull stack:\n${error.stack}\n`;
                console.error('Detailed error:', error);
            }
        };
    </script>
</body>
</html>
